### 詳細分析要素の案内{#details}

![profile_apm sc](/img/tx-trace-static.png)

#### ![number1](/img/number-01.png) トランザクション属性と性能情報

上段右側の**_もっと見る_**ボタンをクリックすると、次のようにトランザクション属性と性能要約情報が確認できます。 

![profile_apm](/img/tx-trace-dt.png)

-   ![統計アイコン](/img/ic-static.svg) **_統計_**：該当URLの統計データ **_要約_** ウィンドウが表示されます。 **_要約_** ウィンドウから **_詳細 >_** ボタンをタップすると **_統計/分析_** > **_統計_** 画面に移動します。 
-   ![右矢印アイコン](/img/ic-arrow-right.svg) **_MTID_**：関連トランザクションを追加で照会・分析できます。

**トランザクションの属性・性能**

| プロパティ           | 性能情報                                                      |
| --------------- | --------------------------------------------------------- |
| **プロジェクトコード**   | WhaTapモニタリングプロジェクトコード                                     |
| **OID**         | アプリケーション（エージェント）オブジェクトID                                  |
| **Oname**       | アプリケーションオブジェクト名                                           |
| **Type**        | アプリケーションタイプ - Java、Node.Js、PHP、Pythonなど                   |
| **TID**         | トランザクションID                                                |
| **UrlHash**     | URLのhash値                                                 |
| **UserToken**   | ユーザートークン - WhaTapが付与した固有のユーザーID                           |
| **Method**      | HTTPメソッド - GET、POST、PUT、HEAD など                           |
| **StartTime**   | トランザクションの開始時間                                             |
| **EndTime**     | トランザクションの終了時間                                             |
| **Elapsed**     | トランザクション実行時間                                              |
| **CpuTime**     | CPUの占有時間                                                  |
| **MemAlloc**    | トランザクションが使用したメモリ量                                         |
| **Ipaddr**      | クライアントIP                                                  |
| **Country**     | クライアントの国情報                                                |
| **City**        | クライアントの都市情報                                               |
| **SqlCount**    | SQLの実行件数                                                  |
| **SqlTime**     | SQL実行時間                                                   |
| **FetchCount**  | SQLでデータを照会したレコード件数                                        |
| **FetchTime**   | レコードの照会にかかった時間（重複が発生したり、他のロジックが含まれる場合もある）                 |
| **HttpcCount**  | 外部のHttp Call件数                                            |
| **HttpcTime**   | 外部のHttp Call時間                                            |
| **ClientOs**    | クライアントのOS                                                 |
| **ClientOsPro** | クライアントのOS会社                                               |
| **ClientType**  | クライアントのタイプ（例：ブラウザー）                                       |
| **ClientName**  | クライアントのブラウザー名                                             |
| **UserAgent**   | ウェブクライアント情報。これに基づいて構文解析を行い、ClientOs、ClientOsProなどの情報を抽出する |
| **MTID**        | マルチサーバートランザクションID                                         |
| **Depth**       | マルチサーバートランザクションが何番目のティアかを表示                               |
| **Caller TID**  | 呼び出し元のトランザクションのTid                                        |

:::note

-   エージェントアプリケーションのタイプや設定によっては、表示されない項目がある場合があります。

-   **_統計_**メニューの詳細については、[次の文書](analysis-apm-trs)を参考にしてください。

-   マルチトランザクション追跡の詳細については、[次の文書](trs-multi-trace) を参考にしてください。

:::

#### ![number2](/img/number-02.png) トランザクショントレースの詳細情報

![number2](/img/number-02.png) 領域でトランザクション実行の詳細履歴を確認できます。 **_ダイアグラム_** チャートは、この詳細情報を要約してグラフとして表現したものです。 **_マルチTXチャート_**では、トランザクションごとの連携情報を確認できます。 一覧から **_テーブルビュー_** タブを選択すると、段階別 **_区間時間_**과 **_所要時間_** および **_ステップ内容_** などを確認し、遅くなった区間を確認することができます。 **_テーブルビュー_** タブの各カラムのトランザクショントレース情報は次のとおりです。

-   **_段階_**：ステップの発生順序

-   **_区間時間_**：各段階の開始・終了時間

-   **_ギャップ_**：直前ステップと現在ステップの間のギャップ時間

-   **_所要_**：各メソッドの開始から終了までの所要時間

-   **_ステップ内容_**：該当ステップの詳細な実行履歴

このうち **_ステップ内容_**は、次のように区分されます。

-   **HTTP-HEADERS**：収集されたHTTP Header情報を表示します。

-   **HTTP-PARAMETERS**：収集されたHTTP Parameter情報を表示します。

-   **DB接続**：DB接続のURLと接続時間を表示します。

-   **SQL**：JDBC SQLに対するSQL文、レスポンス時間エラーを表示します。

-   **HTTP Call**：外部httpサービスのURLとレスポンス時間、エラーを表示します。

-   **Message**：メッセージステップに対し、非定型的なすべての区間の履歴を表示します。 ファイルオープン、Http Header出力、パラメータ出力、あるいはユーザーも任意の位置を指定するのに使用できます。

-   **SOCKET**：Socketオープンを表現します。 レスポンス時間は追跡しません。

-   **METHOD**：エージェントに追跡が設定されたメソッド名とレスポンス時間を表示します。

-   **アクティブスタック**：アクティブスタックが収集されたことを意味します。 **_アクティブスタック_** ボタンを選択すると **_アクティブスタック_** ウィンドウが表示され、詳細を確認できます。

**_ツリービュー_**を選択すると、次のようにツリービューの形で分析を確認できます。 アクティブスタックと先に実行されたメソッドとの相関関係を確認するには、そのステップの番号を確認し **_ツリービュー_** タブで次の番号を確認することができます。 多くのメソッドトレースを設定した場合は **_テーブルビュー_**での状態分析がうまくできない場合があります。 一方、メソッドトレース設定をほとんどしていない状態では **_テーブルビュー_**が分析するのに有利です。 

![ツリービュー](/img/tx-trace-tree.png)

**_メソッド要約_** タブは、トレースステップ情報で重複実行されたメソッドに対する分析情報を提供します。**_SQL要約_** タブは、トレースステップ情報で重複実行されたSQL文に対する分析情報を提供します。**_HTTPリクエスト
要約_** タブは、HTTPリクエストの呼び出し件数、合計時間、平均時間などを提供します。**_マルチTXテーブル_** タブは、マルチトランザクションの詳細を提供します。

:::note

**アクティブスタック**

WhaTapは、複数のユーザー リクエストを10秒ごとにスナップショットとして保存します。 スナップショットに保存されたスタック情報はトランザクションに含めますが、このときのスタック情報を **_アクティブスタック_**といいます。

:::

### トランザクションパラメータ照会

1.  SQL変数とHTTPクエリを照会するために、エージェント設定を追加してください。

    ```bash title='whatap.conf' {1,3}
    profile_sql_param_enabled=true 
    // SQLパラメータ照会オプション：オプションが適用されると、SQLパラメータを暗号化して収集します。
    profile_http_parameter_enabled=true 
    // HTTPパラメータ照会オプション：オプションが適用されると、HTTPクエリパラメータを暗号化して収集します。
    ```

2.  設定を適用した後、トレースステップ内のSQL文を選択すると、パラメータが照会できます。

    ![profile-sql](https://img.whatap.io/media/images/Screenshot_2020-12-15_W_JAVA_DEMO_5490_-_Application_Monitoring18.png)  

3.  パラメータ照会に必要なキーは、エージェントがインストールされているサーバーのパス _$WHATAP_HOME/paramkey.txt_ ファイル内の6桁の文字列です。 別の文字列に変更できます。

    ```bash title='paramkey.txt'
    whatap@vmwas01:/apps/whatap$ cat paramkey.txt
    A1B2C3
    ```

    :::note

    _paramkey.txt_内のキーは、SQL変数の照会、HTTPクエリの照会、Threadの中止などに必要です。

    :::
