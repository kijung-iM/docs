**マルチトランザクション**は、他のエージェントやプロジェクトに関連するトランザクションを意味します。WhaTapプロジェクトに登録されたアプリケーションサービス間の呼び出しを追跡するのが**マルチトランザクション追跡**です。 

:::note

**マルチトランザクションの活性化**

マルチトランザクションを追跡するには、活性化オプションを設定する必要があります。 

1.  **_管理_** > **_エージェント設定_**メニューに移動してください。 
2.  **_マルチサーバートランザクション_**設定の下位の**_活性化_**オプションの`mtrace_enabled`の値を`true`に指定してください。

:::

## マルチトランザクショントレース

ホーム画面 > プロジェクト選択 > **_分析_** > **_ヒートマップ_**メニューでチャート領域をドラッグしてください。ドラッグしたチャート領域のトランザクション情報が次のように下段の**_TXトレース_**一覧に表示されます。一覧でマルチトランザクションを含むトランザクションには、![アイコン](/img/ic-s-mult-transation.svg)アイコンが表示されます。

![mtrace_M](/img/tx-trace-table.png)

該当トレースを選択すると、**_統計_**情報ウィンドウが表示されます。マルチトランザクションが追跡される場合は、上段の要約情報タブの**_マルチトランザクション_**で**_MTID_**値を確認することができます。トランザクションで外部呼び出しをする場合にも、同じ**_MTID_**が生成されます。サービスごとにプロジェクトが分離されていても、最初に発行した**_MTID_**を通じてアプリケーション間のすべてのトランザクションを確認できます。**_統計_**ウィンドウを活用したTXトレースの詳細分析の詳細については、[次の文書](trs-profile#details)を参考にしてください。

![mtrace_apm](/img/tx-trace-dt-up.png)

**_MTID_**横の![右矢印アイコン](/img/ic-arrow-right.svg)アイコンを選択すると、**_分析_** > **_マルチトランザクション追跡_**メニューに移動します。**_マルチトランザクション追跡_**メニューでシステム内またはシステム間で発生する様々な呼び出し関係をひと目で把握し、どの部分で問題が発生したのかを識別して改善できるようにトランザクションとトレース情報を提供します。 

![マルチトランザクションチャートsc](/img/multi-tx-cht.png)

![number 1](/img/number-01.png)領域は、**_フィルターパネル_**です。検索のための特定キー値(**_MTID_** / **_CUSTID_**)やプロジェクト一覧を編集して情報をフィルタリングすることができます。適用されたフィルターは、右側の![number 2](/img/number-02.png)に表現されるタブ一覧である**_チャートビュー_**、**_テーブルビュー_**、**_ツリービュー_**の各タブに一括適用されます。

### チャートビュー

**_マルチトランザクション追跡_**メニューの基本画面は、**_チャートビュー_**です。**_チャートビュー_**タブでは、各トランザクションの呼び出し関係を迅速かつ明確にユーザーに提供します。同じ**_MTID_**を持つトランザクションサービスの個別実行時間を確認することができます。トランザクションノードの背景色として表現されている所要時間(**_タイムバー_**)を通じてトランザクション間の呼び出し関係を確認することができます。 

**_チャートビュー_**![number 3](/img/number-03.png)領域の上段オプションを通じて**_タイムバー_**を含む追加情報を確認することができます。**_フォントサイズ_**ボタンを選択すると、チャートに表現されるフォントのサイズが調整できます。**_タイムバー_**、**_アプリケーション名_**、**_プロジェクト_**ボタンを選択するとノードで表現される情報を制御することができます。右側に位置するボタン集合である**_データベース_**、**_外部呼び出し_**、**_内部呼び出し_**ボタンを選択すると、当該トランザクションで発生した他のデータベースコネクションリクエストやHTTP Callの情報もチャートのノードで確認できます。

トランザクションノードを選択すると、次のように**_統計_**ウィンドウが表示されます。 トランザクショントレースにより、そのトランザクションの詳細を確認できます。 **_統計_** ウィンドウを活用したトランザクショントレースの詳細分析に関する詳細については、[次の文書](trs-profile#details)を参考にしてください。

![マルチトランザクションの詳細を見る](/img/multi-tx-stat.png)

### テーブルビュー

**_テーブルビュー_**タブを選択すると、テーブル形式でマルチトランザクション内に含まれる各トランザクションごとの情報を確認できます。![カラム選択アイコン](/img/ic-column.svg) **_カラム選択_**アイコンを選択してテーブル内のカラムを編集できます。 

![マルチトランザクションテーブルビュー](/img/multi-tx-tb.png)

![詳細アイコン](/img/ic-pageview.svg)**_詳細_**アイコンを選択すると、**_チャートビュー_**ノード選択と同様に**_統計_**ウィンドウが表示されます。 トランザクショントレースにより、そのトランザクションの詳細を確認できます。 **_統計_** ウィンドウを活用したトランザクショントレースの詳細分析に関する詳細については、[次の文書](trs-profile#details)を参考にしてください。

### ツリービュー

**_ツリービュー_**タブを選択すると、各トランザクションとそれに属しているトレースの詳細が確認できます。トランザクション所要時間内の各サブトランザクションまたはトレースの開始・所要時間を視覚化し、トランザクションの呼び出し関係をツリー形式で提供します。 

![マルチトランザクションツリービュー](/img/multi-tx-tr.png)

![number 4](/img/number-04.png)領域は、ツリー構造で表現される詳細の表現方式オプションです。**_一行で見る_**と**_複数行で見る_**の2つの方法を提供します。**_一行で見る_**表現方式が基本設定です。上段ボタンを通じて一括的に制御でき、各行を選択して個別の表現方式の転換が可能です。

![number 5](/img/number-05.png)領域は、所要時間オプションです。![タイムバーアイコン](/img/ic-dashbaord-bar-chart-h.svg) **_タイムバー_**、![タイムセットアイコン](/img/ic-custom-time.svg) **_タイムセット_**、![非表示処理アイコン](/img/ic-eye-invisible.svg) **_非表示処理_**の3つの方法を提供します。開始・所要時間の場合、トランザクションの呼び出し環境によって発生する時差を上位トランザクション内のトレースとマッピングを通じて補正して表現するため、実際に収集された時間データとの差が生じる可能性があります。所要時間は、その値に応じて次のように色で表現します。

-   8秒以上：<span class='etrs'>超過遅延</span>状態で<span class='etrs'>赤</span>で表現します。
-   3秒以上8秒未満：<span class='ov5ud10'>遅延</span>状態で<span class='ov5ud10'>オレンジ</span>で表現します。
-   3秒未満：<span class='woer'>正常</span>状態で<span class='woer'>青</span>で表現します。

![number 6](/img/number-06.png)領域は、各トレースタイプによって統計やクエリ情報などを確認できる専用オプションを提供します。該当トレースの![統計アイコン](/img/ic-static.svg)アイコンまたは![ポップアップアイコン](/img/ic-popup.svg)アイコンを選択すると、**_HTTP呼び出し統計_**、**_アクティブスタック_**などの要約ウィンドウが確認できます。

## 参考資料

-   [マルチトランザクションメニューの追加](https://www.whatap.io/ko/blog/85/index.html)
-   [マルチトランザクションダイアグラムの改善](https://www.whatap.io/ko/blog/72/index.html)
