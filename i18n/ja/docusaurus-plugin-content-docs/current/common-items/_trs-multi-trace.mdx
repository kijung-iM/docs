**マルチトランザクション**は、他のエージェントやプロジェクトに関連するトランザクションを意味します。WhaTapプロジェクトに登録されたアプリケーションサービス間の呼び出しを追跡するのが**マルチトランザクション追跡**です。 

:::note

**マルチトランザクションの活性化**

マルチトランザクションを追跡するには、活性化オプションを設定する必要があります。 

1.  **_管理_** > **_エージェント設定_**メニューに移動してください。 
2.  **_マルチサーバートランザクション_**設定の下位の**_活性化_**オプションの`mtrace_enabled`の値を`true`に指定してください。

:::

## マルチトランザクショントレース

ホーム画面 > プロジェクト選択 > **_分析_** > **_ヒートマップ_**メニューでチャート領域をドラッグしてください。ドラッグしたチャート領域のトランザクション情報が次のように下段の**_TXトレース_**一覧に表示されます。一覧でマルチトランザクションを含むトランザクションには、![アイコン](/img/ic-s-mult-transation.svg)アイコンが表示されます。

![mtrace_M](/img/tx-trace-table.png)

該当トレースを選択すると、**_統計_**情報ウィンドウが表示されます。マルチトランザクションが追跡される場合は、上段の要約情報タブの**_マルチトランザクション_**で**_MTID_**値を確認することができます。トランザクションで外部呼び出しをする場合にも、同じ**_MTID_**が生成されます。サービスごとにプロジェクトが分離されていても、最初に発行した**_MTID_**を通じてアプリケーション間のすべてのトランザクションを確認できます。**_統計_**ウィンドウを活用したTXトレースの詳細分析の詳細については、[次の文書](trs-profile#details)を参考にしてください。

![mtrace_apm](/img/tx-trace-dt-up.png)

**_MTID_**横の![右矢印アイコン](/img/ic-arrow-right.svg)アイコンを選択すると、**_分析_** > **_マルチトランザクション追跡_**メニューに移動します。**_マルチトランザクション追跡_**メニューでシステム内またはシステム間で発生する様々な呼び出し関係をひと目で把握し、どの部分で問題が発生したのかを識別して改善できるようにトランザクションとトレース情報を提供します。 

![マルチトランザクションチャートsc](/img/multi-tx-cht.png)

![number 1](/img/number-01.png)領域は、***フィルターパネル***です。検索のための特定キー値(***MTID*** / ***CUSTID***)やプロジェクト一覧を編集して情報をフィルタリングすることができます。適用されたフィルターは、右側の![number 2](/img/number-02.png)に表現されるタブ一覧である***チャートビュー***、***テーブルビュー***、***ツリービュー***の各タブに一括適用されます。

### チャートビュー

**_マルチトランザクション追跡_**メニューの基本画面は、**_チャートビュー_**です。**_チャートビュー_**タブでは、各トランザクションの呼び出し関係を迅速かつ明確にユーザーに提供します。同じ**_MTID_**を持つトランザクションサービスの個別実行時間を確認することができます。トランザクションノードの背景色として表現されている所要時間(**_タイムバー_**)を通じてトランザクション間の呼び出し関係を確認することができます。 

**_チャートビュー_**![number 3](/img/number-03.png)領域の上段オプションを通じて**_タイムバー_**を含む追加情報を確認することができます。**_フォントサイズ_**ボタンを選択すると、チャートに表現されるフォントのサイズが調整できます。**_タイムバー_**、**_アプリケーション名_**、**_プロジェクト_**ボタンを選択するとノードで表現される情報を制御することができます。右側に位置するボタン集合である**_データベース_**、**_外部呼び出し_**、**_内部呼び出し_**ボタンを選択すると、当該トランザクションで発生した他のデータベースコネクションリクエストやHTTP Callの情報もチャートのノードで確認できます。

トランザクションノードを選択すると、次のように**_統計_**ウィンドウが表示されます。 トランザクショントレースにより、そのトランザクションの詳細を確認できます。 **_統計_** ウィンドウを活用したトランザクショントレースの詳細分析に関する詳細については、[次の文書](trs-profile#details)を参考にしてください。

![マルチトランザクションの詳細を見る](/img/multi-tx-stat.png)

### テーブルビュー

**_テーブルビュー_**タブを選択すると、テーブル形式でマルチトランザクション内に含まれる各トランザクションごとの情報を確認できます。![カラム選択アイコン](/img/ic-column.svg) **_カラム選択_**アイコンを選択してテーブル内のカラムを編集できます。 

![マルチトランザクションテーブルビュー](/img/multi-tx-tb.png)

![詳細アイコン](/img/ic-pageview.svg)**_詳細_**アイコンを選択すると、**_チャートビュー_**ノード選択と同様に**_統計_**ウィンドウが表示されます。 トランザクショントレースにより、そのトランザクションの詳細を確認できます。 **_統計_** ウィンドウを活用したトランザクショントレースの詳細分析に関する詳細については、[次の文書](trs-profile#details)を参考にしてください。

### ツリービュー

**_ツリービュー_**タブを選択すると、各トランザクションとそれに属しているトレースの詳細が確認できます。トランザクション所要時間内の各サブトランザクションまたはトレースの開始・所要時間を視覚化し、トランザクションの呼び出し関係をツリー形式で提供します。 

![マルチトランザクションツリービュー](/img/multi-tx-tr.png)

![number 4](/img/number-04.png)領域は、ツリー構造で表現される詳細の表現方式オプションです。**_一行で見る_**と**_複数行で見る_**の2つの方法を提供します。**_一行で見る_**表現方式が基本設定です。上段ボタンを通じて一括的に制御でき、各行を選択して個別の表現方式の転換が可能です。

![number 5](/img/number-05.png)領域は、所要時間オプションです。![タイムバーアイコン](/img/ic-dashbaord-bar-chart-h.svg) **_タイムバー_**、![タイムセットアイコン](/img/ic-custom-time.svg) **_タイムセット_**、![非表示処理アイコン](/img/ic-eye-invisible.svg) **_非表示処理_**の3つの方法を提供します。開始・所要時間の場合、トランザクションの呼び出し環境によって発生する時差を上位トランザクション内のトレースとマッピングを通じて補正して表現するため、実際に収集された時間データとの差が生じる可能性があります。所要時間は、その値に応じて次のように色で表現します。

-   8秒以上：<span class='etrs'>超過遅延</span>状態で<span class='etrs'>赤</span>で表現します。
-   3秒以上8秒未満：<span class='ov5ud10'>遅延</span>状態で<span class='ov5ud10'>オレンジ</span>で表現します。
-   3秒未満：<span class='woer'>正常</span>状態で<span class='woer'>青</span>で表現します。

![number 6](/img/number-06.png)領域は、各トレースタイプによって統計やクエリ情報などを確認できる専用オプションを提供します。該当トレースの![統計アイコン](/img/ic-static.svg)アイコンまたは![ポップアップアイコン](/img/ic-popup.svg)アイコンを選択すると、***HTTP呼び出し統計***、***アクティブスタック***などの要約ウィンドウが確認できます。

## 参考資料

-   [マルチトランザクションメニューの追加](https://www.whatap.io/ko/blog/85/index.html)
-   [マルチトランザクションダイアグラムの改善](https://www.whatap.io/ko/blog/72/index.html)

<!-- 

**멀티 트랜잭션**은 다른 에이전트나 프로젝트와 연관된 트랜잭션을 의미합니다. 와탭 프로젝트에 등록된 애플리케이션 서비스 간의 호출을 추적하는 것이 **멀티 트랜잭션 추적**입니다. 

:::note 
멀티 트랜잭션 활성화
멀티 트랜잭션을 추적하려면 활성화 옵션을 설정해야 합니다. 
1. ***관리*** > ***에이전트 설정*** 메뉴로 이동하세요. 
1. ***멀티서버 트랜잭션*** 설정 하위의 ***활성화*** 옵션 `mtrace_enabled`의 값을 `true`로 지정하세요.
:::

1. 홈 화면 > 프로젝트 선택 > ***분석*** > ***히트맵*** 메뉴에서 차트 영역을 드래그하세요.<br/>
  드래그한 차트 영역의 트랜잭션 정보가 다음과 같이 하단 ***TX 트레이스*** 목록에 나타납니다. 목록에서 멀티 트랜잭션을 포함한 트랜잭션은 ![아이콘](/img/ic-s-mult-transation.svg) 아이콘이 표시됩니다.

  ![mtrace_M](/img/tx-trace-table.png)

1. 해당 트레이스를 선택하면 ***통계*** 정보 창이 나타납니다.<br/>
  멀티 트랜잭션이 추적되는 경우 상단 요약 정보 탭의 ***멀티 트랜잭션***에서 **MTID** 값을 확인할 수 있습니다. 트랜잭션에서 외부 호출을 하는 경우에도 동일한 **MTID**가 생성됩니다. 업무별로 프로젝트가 분리되어 있더라도 처음 발급한 **MTID**를 통해 애플리케이션 간의 모든 트랜잭션을 확인할 수 있습니다. ***통계*** 창을 활용한 TX 트레이스 상세 분석에 관한 자세한 내용은 [다음 문서](trs-profile#details)를 참조하세요.

  ![mtrace_apm](/img/tx-trace-dt-up.png)

1. ***멀티 트랜잭션*** 옆의 ![오른쪽 화살표 아이콘](/img/ic-arrow-right.svg) 아이콘을 선택하면 ***분석*** > ***멀티 트랜잭션 추적*** 메뉴로 이동합니다.<br/>
  ***멀티 트랜잭션 추적*** 메뉴의 기본 화면은 ***차트 뷰***입니다. ***차트 뷰*** 탭에서는 동일한 **MTID**를 갖는 트랜잭션 서비스들의 개별 수행 시간을 확인할 수 있습니다.

  ![멀티 트랜잭션 차트](/img/multi-tx-cht.png)

1. ***테이블 뷰*** 탭을 선택하세요.<br/>
  ***테이블 뷰*** 탭에서는 티어별 트랜잭션 트레이스 정보를 확인할 수 있습니다. 

  ![멀티 트랜잭션 테이블 뷰](/img/multi-tx-tb.png)

  ![상세 아이콘](/img/ic-pageview.svg)상세 아이콘을 선택하면 ***통계*** 창이 나타납니다. 같은 프로젝트에 속한 애플리케이션 서비스 간의 호출 관계를 확인할 수 있습니다. 

  ![멀티 트랜잭션 상세 보기](/img/multi-tx-stat.png)
  
:::note
Caller와 Callee
* **Caller**: 서비스를 호출한 트랜잭션(호출자)을 의미합니다.
* **Callee**: 서비스를 호출 당한 트랜잭션(피호출자)을 의미합니다.
:::

## 참고 자료

* [멀티 트랜잭션 메뉴 추가](https://www.whatap.io/ko/blog/85/index.html)
* [멀티트랜잭션 다이어그램 개편](https://www.whatap.io/ko/blog/72/index.html)

-->

<!-- 
 * ![왼쪽 아이콘](/img/ic-metrics-cube-back.svg) 아이콘을 선택하면 ***프로젝트 목록***을 숨기고 차트에 집중할 수 있도록 ***차트 뷰*** 영역을 확장시킬 수 있습니다.
 같은 프로젝트에 속한 애플리케이션 서비스들 간의 호출 관계는 트레이스 내에서 데이터를 확인할 수 있습니다.
-->

<!--
서비스(업무) 별로 분리되어 있는 애플리케이션 서비스들 간의 호출을 추적할 수 있습니다. 와탭에 등록되어 있는 프로젝트라면 프로젝트에 등록된 애플리케이션 서비스들 간의 호출에 대한 추적을 말합니다.
화면에서 멀티 트랜잭션 추적이 적용된 경우 히트맵 트랜잭션을 드래그하세요.

-->

<!--

**멀티 트랜잭션**은 다른 APM과 연계된 트랜잭션을 의미합니다. 단일 APM에서 분리된 모든 트랜잭션을 수집하면 부하가 많이 걸리기 때문에 하나의 트랜잭션에 연계된 트랜잭션을 같이 수집합니다. **멀티 멀티 트랜잭션 추적**은 와탭 프로젝트에 등록된 애플리케이션 서비스 간의 호출을 추적하는 것을 의미합니다.

1. 멀티 트랜잭션을 추적하려면 에이전트 설정 파일에 다음 옵션을 설정하세요.<br/>
  `mtrace_enabled`는 값이 `true`일 때 기본값 10% 비율로 멀티 트랜잭션을 추적합니다.  

  ```ini title='whatap.conf'
  mtrace_enabled=true 
  ```

-->
