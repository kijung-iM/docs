ホーム画面 > プロジェクト選択 > **_管理_** > **_ログ設定_**

WhaTapモニタリングサービスの初期画面でプロジェクトを選択し、プロジェクトメニューの下位にある**_管理_** >**_ログ設定_**メニューを選択してください。 

**_로그 설정_** 메뉴에서 로그 모니터링 관련 설정을 할 수 있습니다. 에이전트 설정 확인, 로그 모니터링의 활성화 여부 결정, 로그 데이터의 유지 기간 및 조회 비밀번호 설정, 로그 파서 등록, 빠른 인덱스 설정 등의 메뉴를 사용할 수 있습니다.

<InDoc product='aws-log'>

{@include: ../common-items/_log-role-aws-log.mdx} 

![ログ設定sc](/img/log-setting-aws.png) 

</InDoc>

<InDoc product='log'>

{@include: ../common-items/_log-role.mdx}  

![ログ設定sc](/img/log-setting.png)

</InDoc>

## ![](/img/number-01.png)案内と料金プランの確認

![number-s](/img/number-01.png)領域の**_ガイドを見る_**ボタンと**_料金プランを見る_**ボタンをクリックすると、関連案内画面に移動します。 

## ![](/img/number-02.png)ログモニタリングの開始

![number-s](/img/number-02.png) 領域の**_ログモニタリングのアクティブ化_**トグルボタンでログモニタリングアクティブ化および非アクティブ化可否を設定してください。

<InDoc product='aws-log'>

![](/img/log-start-aws.png)

-   ![アイコン](/img/ic-toggle-on.svg)トグルボタンをオンにすると、ログモニタリンがアクティブになります。 활성화한 날부터 15일 동안 무료로 체험하실 수 있습니다.
-   ![아이콘](/img/ic-toggle-off.svg) 토글 버튼을 끄면 로그 모니터링이 비활성화됩니다. 로그를 더 이상 저장하지 않습니다. 

</InDoc>

<InDoc product='log'>

### エージェント設定の確認

로그 모니터링을 시작하기 위해 에이전트 버전과 설정 정보를 확인하세요. ![number-s](/img/number-02.png) 영역의 **_에이전트 설정 확인_** 메뉴를 선택하여 안내대로 과정을 진행하세요.

-   **애플리케이션 모니터링**<br/>
       **_적용하기_** 메뉴 하위에 애플리케이션별 적용 안내를 확인하세요. 다음 설명서 [Java](log-java), [PHP](log-php), [Python](log-python), [Go](log-go) 등을 참조하세요.

-   **서버 모니터링**<br/>
      **_적용하기_** 메뉴 하위에 개별 적용 안내를 확인하세요. [다음 문서](log-server)를 참조하세요. 안내대로 _whatap.conf_ 에 로그 감시 대상 파일 설정을 추가하세요.

-   **쿠버네티스 모니터링**<br/>
      **_적용하기_** 메뉴 하위에 개별 적용 안내를 확인하세요. [다음 문서](log-k8s)를 참조하세요. 

### ログモニタリングの活性化

![number-s](/img/number-02.png)領域の**_ログモニタリングアクティブ化_**メニューをクリックしてログモニタリングアクティブ化および非アクティブ化をするかどうかを設定してください。

![](/img/log-start.png)

-   ![アイコン](/img/ic-toggle-on.svg)トグルボタンをオンにすると、ログモニタリンがアクティブになります。 활성화한 날부터 15일 동안 무료로 체험하실 수 있습니다. 
-   ![아이콘](/img/ic-toggle-off.svg) 토글 버튼을 끄면 로그 모니터링이 비활성화됩니다. 로그를 더 이상 저장하지 않습니다. 

</InDoc>

## ![](/img/number-03.png)ログモニタリングのデータ設定

![number-s](/img/number-03.png) 상단에서 **_로그 사용량_**을 확인할 수 있습니다. 또한 **_데이터 유지 기간_** 및 **_로그 조회 비밀번호_** 설정을 변경할 수 있습니다.

### データ保持期間

<!-- 수연님 편집 중 -->

공통으로 적용할 기본(default) 데이터 유지 기간입니다. 카테고리별 데이터 유지 기간을 별도로 설정하지 않으면 이 데이터 유지 기간이 기본적으로 적용됩니다. 카테고리별 데이터 유지 기간을 설정하고 **_리셋_** 버튼을 선택하면 기본 데이터 유지 기간으로 초기화됩니다.

### カテゴリ別のデータ保持期間

<!-- 저장량 컬럼 삭제 -->

카테고리별 로그 데이터 유지 기간을 지정할 수 있습니다. **로그 수**는 해당 기간 동안 쌓인 로그 라인을 의미합니다. 예를 들어 **_금일 로그 수_**는 하루 동안 쌓인 로그 라인 개수, **_예상 로그 수_**는 데이터 보관일에 금일 로그 수를 곱한 로그 라인 개수를 의미합니다. 

로그 데이터 유지 기간을 다음과 같이 지정할 수 있습니다. 기간 지정에 따라 오래된 데이터를 삭제해 공간을 확보할 수 있습니다.

-   **トライアルプロジェクト**<br/>
      データ保持期間として1日、2日、3日を選択できます。
-   **有料プロジェクト**<br/>
      データ保持期間として1日、2日、3日、4日、5日、6日、7日、10日、30日、40日を選択できます。
-   **保存容量に基づく料金**<br/>
      データの保持期間によってコストが異なります。
    > 例えば、1日平均200万ログラインが蓄積され、データ保持期間を3日に指定した場合は、平均600万ログラインが収集サーバーに維持され、課金対象となります。

### ログ照会パスワード

보안을 강화하기 위해 **_로그 조회 비밀번호_**를 설정하세요. 로그 조회 비밀번호 지정은 선택 사항입니다. 로그 조회 비밀번호를 사용 중이라면 로그 화면 진입 시 반드시 비밀번호를 입력해야 합니다. 

:::note

<InDoc product='log'>

**パスワードの紛失**

**프로젝트 수정** 권한이 있는 경우 **_로그 설정_** 메뉴에서 새 비밀번호로 수정할 수 있습니다.

</InDoc>

<InDoc product='aws-log'>

**パスワードの紛失**

**로그 편집** 권한이 있는 경우 **_로그 설정_** 메뉴에서 새 비밀번호로 수정할 수 있습니다.

</InDoc>

:::

## ![](/img/number-04.png)ログパーサー設定

수집된 로그를 검색할 수 있는 키를 만들기 위해 **파싱**(Parsing) **로직을 등록**할 수 있습니다. 파싱 로직을 등록하지 않은 경우 다음의 key들로만 검색이 가능합니다.

:::note 

**パーシングロジック未登録時に検索可能なkey**

`category`, `oid`, `oname`, `okind`, `okineName`, `@txid`, `@login`, `httphost` 

:::

### パーサー登録の手順

![](/img/log-setting-parser.png)

1.  ![number-s](/img/number-04.png)領域下段の**_+追加_**を選択してください。

2.  ![number-s](/img/number-04.png) 영역 **_파서 선택창_**에서 파서를 선택하세요. 파서 및 패턴 등록에 관한 [다음 문서](#log-pattern)를 참조하세요

3.  ![number-s](/img/ic-number-07.svg)領域**_カテゴリの選択ウィンドウ_**でカテゴリを選択または直接に入力してください。 

4.  ![number-s](/img/ic-number-07.svg) 영역 ![아이콘](/img/ico-filter.svg)**_필터_** 버튼을 선택해 필터를 추가할 수 있습니다. 필터 입력 시 필터 조건에 맞는 로그 데이터에만 패턴을 적용합니다.

5.  등록하려는 패턴이 정상적인지 ![number-s](/img/ic-number-08.svg) 영역 **_시뮬레이션_** 버튼을 선택해 시뮬레이션 및 패턴의 퍼포먼스를 측정하세요. 시뮬레이션과 퍼포먼스 측정에 관한 [다음 문서](#parser-simulation)를 참조하세요.

6.  シミュレーション結果が正常であれば、[number-s](/img/ic-number-08.svg)領域**_保存_**ボタンをクリックして保存してください。

:::note

-   ![number-s](/img/ic-number-07.svg)**_フィルター_**を追加することはオプションです。
-   ![number-s](/img/ic-number-08.svg)領域**_リセット_**ボタンをクリックすると、作成中の内容が初期化されます。
-   ![number-s](/img/ic-number-09.svg)ボタンを選択してから、パーサー設定をドラッグして手順を変更できます。

:::

### 設定項目

| 設定値   | 説明                                                                               | その他           |
| ----- | -------------------------------------------------------------------------------- | ------------- |
| カテゴリ  | パターンを適用するカテゴリです。                                                                 | required      |
| フィルター | 필터로 적용할 `search key`, `search value`를 입력합니다. 필터 조건에 맞는 로그 데이터에만 패턴을 적용합니다.       | optional      |
| パターン  | 로그를 파싱(parsing)할 패턴입니다. 작성한 패턴에 맞추어서 파싱을 하고, 인덱스를 생성합니다. Grok, Custom 문법을 지원합니다. | required      |
| アクティブ | アクティブ化または非アクティブ化の可否です。                                                           | デフォルト値は`true` |

### パターン登録のタイプ{#log-pattern}

![](/img/log-parser-pattern.png)

다음과 같이 4가지 유형의 파서를 제공합니다. ![number-s](/img/number-04.png) 영역 파서 선택창에서 확인할 수 있습니다.

1.  **Grokパーサー**
2.  **JSONフォーマットパーサー**
3.  **4xx**と**5xxステータスコードのパーサー**
4.  **ステータスコードの成功率のパーサー** 
    <!-- **Grok**과 **JSON 포맷 파서** 2가지 유형의 파서를 제공합니다. ![number-s](/img/number-04.png) 영역 파서 선택창에서 확인할 수 있습니다. -->

:::note

-   4XX, 5XXステータスコードパーサーとステータスコード成功率パーサーは、GrokまたはJSONフォーマットパーサーを通じてstatusキーが抽出されていないと活用できません。
-   パーサー登録時、同じカテゴリーにパーサーを重複登録することはできません。

:::

### Grokパターンパーサー登録

![Grokパターンパーサー](https://img.whatap.io/media/images/log_011_grok_syntax.png)
文法は%{SYNTAX:SEMANTIC}です。    

-   **SYNTAX**<br/>
      Grok定義のパターンです。      

-   **SEMANTIC**<br/>
      パーシングされたデータに割り当てるキーです。

:::note 

SEMANTICには予約語などが使用されないように複合語の使用を推奨します。

:::

### JSONフォーマットのパーサーパターンの登録

![JSONフォーマットのパーサーパターンの登録](https://img.whatap.io/media/images/log_012_json_format_parser_1101.png)<br/>
ログの全体または一部がJSON形式として出力される場合、JSONフォーマットパーサーを通じてJSONに出力された部分をパーシングすることができます。

로그 중 JSON 형태로 출력된 부분을 검출하기 위하여 **_Prefix_**, **_Postfix_** 옵션을 조합해 로그의 어느 부분을 JSON으로 인식해 파싱할지 지정합니다. 

| オプション    | 説明                                                                    |
| -------- | --------------------------------------------------------------------- |
| プレフィックス  | JSON 문자열의 시작 부분 앞의 문자열을 지정합니다. 미지정 시 로그 출력문의 맨 앞부터 JSON 문자열로 식별합니다.   |
| ポストフィックス | JSON 문자열의 종료 부분 뒤의 문자열을 지정합니다. 미지정 시 로그 출력문의 맨 뒤 까지를 JSON 문자열로 식별합니다. |
| 無視する     | JSON出力部のうち、キー抽出を除くフィールドを指定します。                                        |

-   **登録例**

    ```bash title='로그 원문'
    [2022-10-25 10:15:34:145]...(改行)
    Request : {"key1":"value1","key2":"value2",...}(改行)
    Response : {"key3":"value3","key4":"value4",...}
    ```

      例のように流入するログがRequest JSON、Response JSONをすべてパーシングしようとする場合は、次の2つのパターンを登録します。

    -   Requestパーシング用のパターン  

        > "Request : " 와 "Response" 사이의 문자열 {"key1":"value1","key2":"value2",...} 対象

    -   Reponseパーシング用のパターン
        > "Response : " 부터 로그의 마지막 까지의 문자열 {"key3":"value3","key4":"value4",...} 対象
-   **JSONカスタムパターンの登録**

      로그 중 일부가 JSON 형태로 출력되는 경우 JSON으로 출력된 부분을 전용 커스텀 파서를 통해 파싱할 수 있습니다. 패턴을 다음과 같이 입력하세요.

    ```java
    io.whatap.logsink.parser.JsonFormatParser{}
    ```

      로그 중 JSON 형태로 출력된 부분을 검출하기 위해 **_Prefix_**, **_Postfix_** 옵션을 조합해 로그의 어느 부분을 JSON으로 인식하여 파싱할지 지정하세요.

      `JsonFormatParser{}`の`{}`にオプションを指定します。

    -   **登録例**

        ```bash title='로그 원문'
        [2022-10-25 10:15:34:145]...(改行)
        Request : {"key1":"value1","key2":"value2",...}(改行)
        Response : {"key3":"value3","key4":"value4",...}
        ```

          例のように流入するログがRequest JSON、Response JSONをすべてパーシングしようとする場合は、次の2つのパターンを登録します。

        -   Requestパーシング用のパターン  
            > "Request : " 와 "Response" 사이의 문자열 {"key1":"value1","key2":"value2",...} 対象

        ```java
        io.whatap.logsink.parser.JsonFormatParser {prefix:"Request : ",postfix:"Response"}
        ```

        -   Reponseパーシング用のパターン
            > "Response : " 부터 로그의 마지막 까지의 문자열 {"key3":"value3","key4":"value4",...} 対象

        ```java
        io.whatap.logsink.parser.JsonFormatParser {prefix: "Response : "}
        ```

### 4xx, 5xxステータスコードのパーサーパターン登録{#4xx-5xx-status-parser}

![4XX 5XX 상태 코드 파서](https://img.whatap.io/22/11/28/085706log_020_status_parser.png)<br/>
status가 이미 파싱된 경우 사용할 수 있는 파서입니다. 파싱된 status를 이용하여 추가적으로 4xx, 5xx 상태 코드를 파싱합니다. 파싱한 데이터로 4xx, 5xx 건수 데이터를 생성할 수 있습니다. 

패턴에는 4xx, 5xx 상태 코드를 입력 또는 선택 할 수 있으며, 입력된 상태 코드는 로그에서 4xx, 5xx 상태 코드를 파싱할 때 제외됩니다. 4xx, 5xx 상태 코드 파서를 사용하기 위해 먼저 status가 파싱되어 있어야 합니다.

-   **status 파서 등록 예시**<br/>
      ![Grok파서 - status 파싱 패턴 등록](https://img.whatap.io/22/11/28/111724log_status_01_parser.png)<br/>
      유입되는 로그가 `{"msg":"message","status":404}`이고 예시처럼 Grok 파서로 status를 파싱한다면, `status: 404`와 같이 파싱됩니다. status가 정상적으로 파싱되는 것을 확인헸다면 4XX,5XX 상태 코드 파서 패턴을 등록하세요.     

-   **ウィジェットテンプレート**<br/>
      パーサーをすべて登録すると**_Flexボード_**に移動し、ログ 4XX、5XX 件数ウィジェットを作成してください。

      ![](https://img.whatap.io/22/11/28/111724log_status_02_widget_template.png)  

      ウィジェットを作成すると、次のようにデータを確認できます。

      ![](https://img.whatap.io/22/11/28/111724log_status_03_widget.png)

    -   **_avg_**：照会期間中のデータの平均値です。
    -   **max**：照会期間中のデータの最大値です。
    -   **_recently_**：照会期間中のデータの最後の値です。

### ステータスコード成功率のパーサーパターンの登録

![상태 코드 성공률 파서](https://img.whatap.io/22/11/28/090004log_021_status_success_rate_parser.png)
상태 코드 성공률 파서는 status가 이미 파싱된 경우 사용할 수 있는 파서입니다. status 파싱에 관한 내용은 [다음 문서](#4xx-5xx-status-parser)를 참조하세요. 

파싱된 status를 이용하여 추가로 2xx, 3xx 상태 코드를 파싱합니다. 파싱한 데이터로 HTTP 요청 성공률 데이터를 생성할 수 있습니다. 패턴에는 2xx, 3xx 상태 코드를 입력 또는 선택 할 수 있으며, 입력된 상태 코드는 로그에서 2xx, 3xx 상태 코드를 파싱할 때 제외됩니다. 

-   **ウィジェットテンプレート**<br/>
      パーサーをすべて登録したら、**_Flexボード_**に移動し、ログリクエスト成功率のウィジェットを作成してください。  

      ![Flexボード - ログリクエスト成功率のウィジェットテンプレート](https://img.whatap.io/22/11/28/120046log_success_rate_01_widget_template.png)  

      ウィジェットを作成すると、次のようにデータを確認できます。

      ![Flexボード - ログリクエスト成功率のウィジェット](https://img.whatap.io/22/11/28/120046log_success_rate_02_widget.png)

      차트 위 데이터는 조회 기간에 대한 통계를 나타냅니다. 통계 방법을 최근값, 최댓값, 평균값 등으로 선택할 수 있습니다. 최근값이 기본으로 선택되어 있습니다.

### パーサーシミュレーション{#parser-simulation}

:::note

**シミュレーションサポート**

現在、JSONフォーマットのパーサーはシミュレーション機能をサポートしていません。

:::

登録しようとするパターンでパーシングに成功するか確認してください。

<!--
1117 
json 커스텀 파서 추가 문의
30일 이후 업데이트 예정인 패턴 체크
-->

<!--
* **로그 파서 시뮬레이션 시작**
    ![](https://img.whatap.io/media/images/log_013_simulation_1101.png)
-->

-   **シミュレーションの成功画面**
      ![](https://img.whatap.io/media/images/log_014_simulation_success.png)

-   **シミュレーションの失敗画面**
      ![](https://img.whatap.io/media/images/log_015_simulation_fail.png)

### パフォーマンス測定

시뮬레이션 성공 후 **_퍼포먼스 측정_** 버튼을 선택하여 파서에 대한 퍼포먼스를 측정할 수 있습니다. 시뮬레이션 수행 대상 문자열에 대하여 파서의 반복 파싱 소요 시간을 측정 후 다음과 같이 측정 결과를 팝업으로 확인할 수 있습니다.

![](https://img.whatap.io/media/images/log_016_performance.png)

### パーシング成功

파싱 로직을 등록하여 키(key)가 생성되면 로그 조회 시 해당 키로 파싱된 값이 추가됩니다. 다음 이미지의 파란 박스 부분에 파싱된 키와 값이 추가됩니다. 

![](https://img.whatap.io/media/images/log_017_parsed.png)

パーシングされたキーは**_ライブテール_**、**_ログ検索_**、**_ログトレンド_**で確認できます。

## ![](/img/number-05.png)高速インデックス設定

대량의 로그를 수집할 경우 로그 검색 성능이 현저하게 저하될 수 있습니다. 자주 사용하는 검색 조건을 **인덱스**(index)로 생성하면 로그 검색 성능을 개선해 빠른 탐색이 가능합니다. 설정 항목은 다음과 같습니다.

| 設定値           | 必修の有無 | 説明                                |
| ------------- | ----- | --------------------------------- |
| カテゴリ          | 必須    | 高速クインデックスを設定するカテゴリ                |
| タグ            | 必須    | 高速インデックスを設定するタグ                   |
| 大文字と小文字を区別しない | オプション | 大文字と小文字を区別するかどうか                  |
| 規則            | 必須    | `*` を一つ以上必ず含む。                    |
| アクティブ         | 必須    | アクティブ化または非アクティブ化の有無（デフォルト `true`） |

## ![](/img/number-06.png)ログ長期保管統計設定

로그 데이터는 용량이 매우 커서 장기간 보관하기가 어렵습니다. 따라서 로그 통계 데이터 설정 기능을 사용하여 **특정 조건을 만족하는 로그 데이터가 5분마다 몇 건씩 수집되었는지에 대한 정보를 저장**할 수 있습니다. 

長期間にわたって実際のログデータが削除されても、該当する条件を満たすログがどれだけ収集されたかの推移を確認することができます。

![ログの長期保管の統計](https://img.whatap.io/22/11/28/090932log_022_long_period_stat_config.png)

### 設定項目

<!-- 제외 항목 내용 추가 예정 .. 추가1202 -->

| フィールド      | 説明                                                                   |
| ---------- | -------------------------------------------------------------------- |
| カテゴリ       | 規則を適用するカテゴリです。                                                       |
| キー（key）    | 規則を満たすログが発生した場合、保存するキー値で同じキーを重複設定することはできません。                         |
| 規則         | 로그 통계 데이터를 생성할 조건입니다. 이 조건을 만족하는 로그가 얼마나 수집되었는지를 기반으로 통계 데이터를 생성합니다. |
| 除外         | 除外をチェックすると、入力した条件に該当しない値で統計データを作成します。                                |
| 大文字と小文字の区分 | 入力したルールの値に対して大文字と小文字を区別するかどうかを指定します。                                 |
| アクティブ      | アクティブ化または非アクティブ化の有無（デフォルト `true`）                                    |

### 例

次のように設定を追加した場合、収集されたログのうちstatusが'200'、'300'であるログを対象に**_TotalCount_**というキー値で統計データを作成します。 

![](https://img.whatap.io/22/11/28/090932log_023_long_period_stat_config.png)

### ウィジェットテンプレート

1.  **_Flex 보드_**의 **_위젯 템플릿_**에서 **_로그 장기 보관 통계_**를 검색해 위젯을 생성하세요.<br/>
    ![장기 보관 통계 위젯 템플릿](https://img.whatap.io/22/11/28/090932log_024_long_period_widget_template.png)
2.  데이터를 조회할 **_카테고리_**와 **_키_**를 지정한 뒤 **_적용_** 버튼을 선택합니다.<br/>
    ![장기 보관 통계 위젯 - 카테고리 및 키 선택](https://img.whatap.io/22/11/28/090932log_025_long_period_widget_config.png)
3.  추가한 설정값으로 **_로그 장기 보관 통계_** 데이터를 다음처럼 확인할 수 있습니다.<br/>
    ![장기 보관 통계 위젯](https://img.whatap.io/22/11/28/090932log_026_long_period_widget_view.png)
