<InDoc product='aws-log'>

ホーム画面 > プロジェクト選択 > **_管理_** > **_ログ設定_**

WhaTapモニタリングサービスの初期画面でプロジェクトを選択し、プロジェクトメニューの下位にある**_管理_** > **_ログ設定_**メニューを選択してください。 

</InDoc>

<InDoc product='log'>

ホーム画面 > プロジェクト選択 > **_ログ_** > **_ログ設定_**

WhaTapモニタリングサービスの初期画面でプロジェクトを選択し、プロジェクトメニューの下位にある**_ログ_** > **_ログ設定_**メニューを選択してください。 

</InDoc>

**_ログ設定_**メニューで、ログモニタリング関連の設定を行うことができます。 上段のタブを通してエージェント設定の確認、ログモニタリングをアクティブにするかどうかの決定、ログデータの保持期間および照会パスワード設定、ログパーサー登録、クイックインデックス設定などのメニューが使用できます。

:::note

-   **_ログモニタリング活性化_**機能を使用するには、**プロジェクト修正**権限が必要です。 

-   **ログ編集**権限を通じて**_ログモニタリング活性化_**機能以外に**_ログ設定_**メニューを修正できます。

:::

## ログモニタリングを開始する{#log-getting-started}

<InDoc product='aws-log'>

![ログモニタリングを開始するsc](/img/log-getting-started-aws.png)

</InDoc>

<InDoc product='log'>

![ログモニタリングを開始するsc](/img/log-getting-started.png)

</InDoc>

上段で**_ログモニタリングを開始する_**タブを選択してください。 ![WhaTap Docsアイコン](/img/ic-guide.svg) **_ガイドを見る_**アイコンと**_料金プランを見る_**ボタンを選択すると、関連した案内画面に移動します。 

### エージェント設定とログモニタリングの活性化{#log-set-up}

<InDoc product='aws-log'>

![number 1](/img/number-01.png)領域の**_ログモニタリング活性化_**トグル ボタンでログモニタリングの活性化・非活性化を設定してください。

![ログモニタリングを開始する](/img/log-start-aws.png)

-   ![アイコン](/img/ic-toggle-on.svg)トグルボタンをオンにすると、ログモニタリンがアクティブになります。 活性化した日から15日間無料で体験できます。
-   ![アイコン](/img/ic-toggle-off.svg)トグルボタンをオフにすると、ログモニタリンが非活性化されます。 これ以上ログを保存しません。 

</InDoc>

<InDoc product='log'>

![number 1](/img/number-01.png)領域でエージェント設定を確認し**_ログモニタリング活性化_**トグル ボタンでログモニタリングの活性化・非活性化を設定してください。

#### エージェント設定確認{#log-check-agent-settings}

ログモニタリングを開始するために、エージェントのバージョンと設定情報を確認してください。 **_エージェント設定確認_**メニューを選択して、案内どおりにプロセスを進めてください。

-   **アプリケーションモニタリング**

    **_適用する_**メニューの下位にあるアプリケーション別適用案内を確認してください。 次の説明書[Java](log-java)、[PHP](log-php)、[Python](log-python)、[Go](log-go) などを参考にしてください。

-   **サーバーモニタリング**

    **_適用する_**メニューの下位にある個別適用案内を確認してください。 [次の文書](log-server)を参考にしてください。 案内どおり_whatap.conf_にログモニタリング対象ファイルの設定を追加してください。

-   **Kubernetesモニタリング**

    **_適用する_**メニューの下位にある個別適用案内を確認してください。 [次の文書](log-k8s)を参考にしてください。 

#### ログモニタリングの活性化{#log-activate}

**_ログモニタリング活性化_**メニューを選択して、ログモニタリングの活性化・非活性化を設定してください。

![](/img/log-start.png)

-   ![アイコン](/img/ic-toggle-on.svg)トグルボタンをオンにすると、ログモニタリンがアクティブになります。 活性化した日から15日間無料で体験できます。 
-   ![アイコン](/img/ic-toggle-off.svg)トグルボタンをオフにすると、ログモニタリンが非活性化されます。 これ以上ログを保存しません。 

</InDoc>

### ログモニタリングデータ設定{#log-data-setting}

![number 2](/img/number-02.png)領域で**_ログ使用量_**が確認できます。 また**_データ保持期間_**および**_ログ照会パスワード_**設定を変更できます。

#### データ保持期間{#data-retention}

共通に適用する基本(default) データ保持期間です。 未指定の場合、デフォルト値は1日です。 カテゴリごとのデータ保持期間を別途設定しない場合は、このデータ保持期間がデフォルトとして適用されます。 カテゴリごとのデータ保持期間を設定し、 **_初期化_**ボタンを選択すると、基本データ保持期間で初期化されます。

#### カテゴリ別データ保持期間{#data-retention-per-category}

カテゴリごとのログ データ保持期間を指定できます。 **ログ数**は、その期間中に蓄積されたログ行数を意味します。 例えば、**_本日のログ数_**は一日の間に蓄積されたログライン個数、**_予想ログ数_**はデータ保管日に本日のログ数を掛けたログライン個数を意味します。 

ログデータ保持期間を次のように指定できます。 期間指定により、古いデータを削除してスペースを確保できます。

-   **トライアルプロジェクト**  

    データ保持期間として1日、2日、3日を選択できます。

-   **有料プロジェクト**  

    データ保持期間として1日、2日、3日、4日、5日、6日、7日、10日、30日、40日を選択できます。

-   **保存量基準課金**   

    データの保持期間によってコストが異なります。

    > 例えば、1日平均200万ログラインが蓄積され、データ保持期間を3日に指定した場合は、平均600万ログラインが収集サーバーに維持され、課金対象となります。

#### ログ照会パスワード{#log-lookup-pw}

セキュリティを強化するため、**_ログ照会パスワード_**を設定してください。 ログ照会パスワードの指定はオプションです。 ログ照会パスワードを使用中の場合は、ログ画面に入るときは必ずパスワードを入力してください。 

:::note

**パスワードの紛失**

**ログ編集**権限がある場合は、**_ログ設定_**メニューで新しいパスワードに変更できます。

:::

## ログ1次パーサー設定{#log-setting-parser-1st}

**_ログ設定_**メニューの上段で**_対数1次パーサー設定_**タブを選択してログパーサーを登録・修正できます。 ログ1次パーサーは、**_GROK_**と**_JSON_**パーサーを提供します。 収集されたログを対象に、パターンの条件と一致するキー情報、つまり検索キーと検索値を抽出します。 構文解析されたログキーは、ログのタイプを分類するための用途および特定のログを検索するためのインデックス用途に使用します。 タイプ別ログ発生数を集計したり、特定のログを迅速に見つけるために登録する必須パーサーです。

-   **_GROK_**：基本的には、正規表現式ベースの構文解析に相当します。 予約キーワードベースの構文解析を提供します。

-   **_JSON_**：ログのうちJSONで出力された部分に対して一括構文解析を提供します。

:::note 

**パーシングロジック未登録時に検索可能なkey**

`category`, `oid`, `oname`, `okind`, `okineName`, `@txid`, `@login`, `httphost` 

:::

### 設定項目{#log-parser-comp}

| 設定値    | 説明                                                                                            | その他      |
| ------ | --------------------------------------------------------------------------------------------- | -------- |
| カテゴリ   | パターンを適用するカテゴリです。                                                                              | required |
| ログ検出条件 | フィルターとして適用する検索キー、検索値を入力します。 ログ検出条件に合ったログデータにパターンを適用します。 ログ検出条件を入力しない場合は、すべてのログを対象にパターンを適用します。 | optional |
| パターン   | 対数を構文解析(parsing)するパターンです。 作成したパターンに合わせて構文解析を行い、インデックスを作成します。 GROK、正規表現式文法に対応します。              | required |

### パーサー一覧{#log-parser-list-1st}

![ログパーサー一覧](/img/log-1st-parser-list.png)

**_ログ設定_**メニューの上段で**_ログ1次パーサー設定_**タブを選択すると、登録したパーサーを照会し、追加および編集が可能な**_パーサー一覧_**画面を確認できます。 

-   上段右側の**_+追加する_**ボタンを選択すると**_パーサー追加_**ウィンドウが表示されます。

-   パーサー一覧**_適用順序_**カラムの![](/img/ic-drag-drop.svg)アイコンをドラッグしてパーサーの設定手順を変更できます。

-   パーサー一覧![アイコン](/img/ic-toggle-on.svg) **_活性化_**トグルでパーサーを活性化有無を指定できます。

-   パーサー一覧![修正アイコン](/img/ico-edit.svg) **_修整_**及び![削除アイコン](/img/ico-trash-red.svg) **_削除_**アイコンで登録したパーサーを修正・削除できます。

### パーサー登録手順{#log-add-parser-1st}

**_ログ設定_**メニューの上段で**_対数1次パーサー設定_**タブを選択してログパーサーを登録・修正できます。 次に、パーサー登録時の共通手順について案内します。

  ![sc](/img/log-1st-parser-add.png)

1.  **_+追加する_**ボタンを選択すると**_パーサー追加_**ウィンドウが表示されます。

2.  **_パーサー_**選択ウィンドウでパーサーを選択してください。 各パーサーおよびパターン登録の詳細については、次の文書を参考にしてください。

    -   **_GROK_** [パーサーおよびパターン登録](#log-pattern-grok)

    -   **_JSON_** [パーサーおよびパターン登録](#log-pattern-json)

3.  **_カテゴリー_**選択ウィンドウでカテゴリを選択するか、直接入力してください。 

4.  **_ログ検出条件_**として活用する**_検索キー_**と**_検索値_**を選択するか、直接入力してください。

  フィルター条件に合ったログ データに限ってパターンを適用します。 **_ログ検出条件_**を指定しない場合は、すべてのログに対してパターンを適用します。

1.  **_パターン_**を入力してください。 

2.  登録しようとするパターンが正常か**_シミュレーション_**ボタンをクリックしてシミュレーション及びパターンのパフォーマンスを測定してください。

  シミュレーションと性能測定の詳細については、[次の文書](#parser-simulation)を参考にしてください。

1.  シミュレーション結果が正常であれば、**_追加_**ボタンを選択してパーサーを登録してください。

:::note

パーサー登録時、同じ**_カテゴリー_**にパーサーを重複登録することはできません。

:::

### GROKパーサーパターン登録{#log-pattern-grok}

![GROKパターンパーサー](/img/log-1st-grok.png)

基本文法は、`%{SYNTAX:SEMANTIC}`です。  

-   **SYNTAX**

    GROK定義パターンです。

-   **SEMANTIC**

    パーシングされたデータに割り当てるキーです。

    :::note 

    SEMANTICには予約語などが使用されないように複合語の使用を推奨します。

    :::

### JSONフォーマットのパーサーパターン登録{#log-pattern-json}

![JSONフォーマットパーサーパターン登録](/img/log-1st-json.png)  

ログ全体または一部がJSON形式で出力される場合、JSONフォーマットパーサーを通じてJSONに出力された部分をパーシングすることができます。 ログのうちJSON形式として出力された部分を検出するために、**_Prefix_**、**_Postfix_**オプションを組み合わせてログのどの部分をJSONとして認識してパーシングするかを指定します。 

| オプション    | 説明                                                                                                             |
| -------- | -------------------------------------------------------------------------------------------------------------- |
| プレフィックス  | JSON文字列の始点の前にある文字列を指定します。 未指定時、ログ出力文の一番前からJSON文字列として識別します。                                                     |
| ポストフィックス | JSON文字列の終了の後ろにある文字列を指定します。 未指定時、ログ出力文の一番後ろまでJSON文字列として識別します。                                                   |
| 無視する     | JSON出力部のうち、キー抽出を除くフィールドを指定します。                                                                                 |

-   **登録例**

    ```bash title='Log'
    [2022-10-25 10:15:34:145]...(改行)
    Request : {"key1":"value1","key2":"value2",...}(改行)
    Response : {"key3":"value3","key4":"value4",...}
    ```

    例のように流入するログがRequest JSON、Response JSONをすべてパーシングしようとする場合は、次の2つのパターンを登録します。

    -   Requestパーシング用のパターン  

        > "Request："と"Response"間の文字列{"key1":"value1","key2":"value2",...} 対象

    -   Reponseパーシング用のパターン

        > "Response："からログの最後までの文字列{"key3":"value3","key4":"value4",...} 対象
-   **JSONカスタムパターンの登録**

    ログの一部がJSON形式で出力される場合、JSONで出力された部分を専用カスタムパーサーを通じてパーシングできます。 パターンを次のように入力してください。

    ```java
    io.whatap.logsink.parser.JsonFormatParser{}
    ```

    ログのうちJSON形式として出力された部分を検出するために、**_Prefix_**、**_Postfix_**オプションを組み合わせてログのどの部分をJSONとして認識してパーシングするかを指定してください。

    `JsonFormatParser{}`の`{}`にオプションを指定します。

    -   **登録例**

        ```bash title='Log'
        [2022-10-25 10:15:34:145]...(改行)
        Request : {"key1":"value1","key2":"value2",...}(改行)
        Response : {"key3":"value3","key4":"value4",...}
        ```

        例のように流入するログがRequest JSON、Response JSONをすべてパーシングしようとする場合は、次の2つのパターンを登録します。

        -   Requestパーシング用のパターン  
            > "Request："と"Response"間の文字列{"key1":"value1","key2":"value2",...} 対象

        ```java
        io.whatap.logsink.parser.JsonFormatParser {prefix:"Request : ",postfix:"Response"}
        ```

        -   Reponseパーシング用のパターン
            > "Response："からログの最後までの文字列{"key3":"value3","key4":"value4",...} 対象

        ```java
        io.whatap.logsink.parser.JsonFormatParser {prefix: "Response : "}
        ```

### パーサーシミュレーション{#parser-simulation}

1.  パーサー追加画面でパターンを入力した後**_シミュレーション_**ボタンを選択してください。 **_パーサーシミュレーション_**ウィンドウが表示されます。 

2.  **_パーサーシミュレーション_**ウィンドウで**_ログ_**を入力してください。 

3.  入力した**_ログ_**と**_パターン_**を確認してください。 

  ![パーサーシミュレーション](/img/log-parser-simulation.png)

1.  **_パターン適用_**ボタンを押すと、選択したパーサーに入力したパターンが適用されます。 登録しようとするパターンでパーシングに成功するか確認してください。 

    -   **シミュレーションの成功画面**

        ![シミュレーション成功](/img/log-simulation-success.png)

    -   **シミュレーションの失敗画面**

        ![シミュレーション失敗](/img/log-simulation-fail.png)

### パフォーマンス測定{#log-performance}

シミュレーション成功後**_パフォーマンス測定_**ボタンを選択して、パーサーのパフォーマンスを測定できます。 シミュレーション実行対象の文字列に対し、パーサーの構文解析が繰り返される所要時間を測定した後、次のように測定結果を確認してください。

![パフォーマンス測定](/img/log-performance.png)

### 構文解析成功{#log-parsed}

構文解析ロジックを登録して**キー**(key)が生成されると、ログ照会時にそのキーで構文解析された値が追加されます。 次の**_ライブテール_**メニュー例のように、構文解析されたキーと値が追加されます。 

![構文解析成功](/img/log-parsed.png)

パーシングされたキーは**_ライブテール_**、**_ログ検索_**、**_ログトレンド_**で確認できます。

## 対数2次パーサー設定{#log-setting-parser-2nd}

**_ログ設定_**メニューの上段で**_対数2次パーサー設定_**タブを選択してログパーサーを登録・修正できます。 **_4xx、5xxステータスコードパーサー_**と**_ステータスコード成功率パーサー_**を提供します。 ログ2次パーサーは、GROKまたはJSONのような1次パーサーが構文解析された場合に使用できるパーサーです。 1次パーサーで抽出した値を加工して統計データを生成します。 ウェブまたはAPIレスポンスログに対してHttp Status Codeに基づいて2次統計を抽出します。

-   **_4xx、5xxステータスコードパーサー_**：異常レスポンスに関する件数情報を集計します。

-   **_ステータスコード成功率パーサー_**：全体の件数に対する異常レスポンスの割合を抽出します。

:::note

ログの2次パーサーは、1次構文解析された結果に対して特殊目的の2次構文解析機能を提供します。 2次パーサーを使用するには、**1次パーサー**が**登録**されている必要があります。

:::

### パーサー一覧{#log-parser-list-2nd}

![対数2次パーサー一覧](/img/log-2nd-parser-list.png)

**_ログ設定_**メニューの上段で**_ログ2次パーサー設定_**タブを選択すると、登録したパーサーを照会し、追加および編集が可能な**_パーサー一覧_**画面を確認できます。 

-   上段右側の**_+追加する_**ボタンを選択すると**_パーサー追加_**ウィンドウが表示されます。

-   パーサー一覧**_適用順序_**カラムの![](/img/ic-drag-drop.svg)アイコンをドラッグしてパーサーの設定手順を変更できます。

-   パーサー一覧![アイコン](/img/ic-toggle-on.svg) **_活性化_**トグルでパーサーを活性化有無を指定できます。

-   パーサー一覧![修正アイコン](/img/ico-edit.svg) **_修整_**及び![削除アイコン](/img/ico-trash-red.svg) **_削除_**アイコンで登録したパーサーを修正・削除できます。

### パーサー登録手順{#log-add-parser-2nd}

**_ログ設定_**メニューの上段で**_対数2次パーサー設定_**タブを選択してログパーサーを登録・修正できます。 次に、パーサー登録時の共通手順について案内します。

  ![sc](/img/log-2nd-parser-add.png)

1.  **_+追加する_**ボタンを選択すると**_パーサー追加_**ウィンドウが表示されます。

2.  **_パーサー_**選択ウィンドウでパーサーを選択してください。 各パーサー設定項目および除外するステータスコード登録の詳細については、次の文書を参考にしてください。

    -   **_4xx、5xxステータスコードパーサー_** [設定項目および除外するステータスコード登録](#4xx-5xx-status-parser)

    -   **_ステータスコード成功率パーサー_** [設定項目および除外するステータスコード登録](#log-pattern-status)

3.  **_カテゴリー_**選択ウィンドウでカテゴリを選択するか、直接入力してください。 

4.  **_ログ検出条件_**を選択するか、直接入力してください。

5.  **_除外するステータスコード_**を入力してください。 

6.  **_追加_**ボタンを選択してパーサーを登録してください。

### 4xx、5xxステータスコードをパーサーから除外するステータスコード登録{#4xx-5xx-status-parser}

![4XX 5XXステータスコードパーサー](/img/log-2nd-4xx5xx.png)

**_4xx、5xxステータスコードパーサー_**は、statusが既に構文解析されている場合に使用できるパーサーです。 構文解析されたstatusを利用して追加で4xx、5xステータスコードを構文解析します。 構文解析したデータで4xx、5xx件数データを作成できます。 除外するステータスコードとして4xx、5xxステータスコードを入力または選択できます。 入力されたステータスコードは、ログから4xx、5xxステータスコードを構文解析するときに除外されます。 

#### 設定項目{#log-parser-comp-4xx5xx}

| 設定値          | 説明                                                                                                      | その他      |
| ------------ | ------------------------------------------------------------------------------------------------------- | -------- |
| カテゴリ         | 4xx、5xx件数データを生成するカテゴリです。                                                                                | required |
| ログ検出条件       | フィルターとして適用する検索キー、検索値を入力します。 ログ検出条件に合ったログデータに対して4xx、5xx件数データを生成します。 ログ検出条件を入力しない場合は、すべてのログに対してデータを生成します。 | optional |
| 除外するステータスコード | 統計データの作成時に除外するステータスコードです。 入力しない場合は、4xx~5xxに該当するエラーステータスコード全体を対象に4xx、5xx件数データを生成します。                     | optional |

#### statusパーサーの登録例

![GROKパーサー - status構文解析パターン登録](/img/log-2nd-4xx5xx-status.png)

流入されるログが`{"msg":"message","status":404}`で、例のようにGROKパーサーでstatusを構文解析する場合、`status: 404`のように構文解析されます。 statusが正常に構文解析されることを確認したら4XX、5XXステータスコードパーサーから除外するステータスコードを登録してください。     

#### データ照会

パーサーをすべて登録すると**_Flexボード_**に移動して**_対数4XX、5XX件数_**ウィジェットを作成してください。

![](https://img.whatap.io/22/11/28/111724log_status_02_widget_template.png) 

ウィジェットを作成すると、次のようにデータを確認できます。

![](https://img.whatap.io/22/11/28/111724log_status_03_widget.png)

-   **_avg_**：照会期間中のデータの平均値です。

-   **max**：照会期間中のデータの最大値です。

-   **_recently_**：照会期間中のデータの最後の値です。

### ステータスコードの成功率をパーサーから除外するステータスコード登録{#log-pattern-status}

![ステータスコード成功率パーサー](/img/log-2nd-status.png)

**_ステータスコード成功率パーサー_**は、statusが既に構文解析されている場合に使用できるパーサーです。 status構文解析に関する内容は、[次の文書](#4xx-5xx-status-parser)を参考にしてください。 構文解析されたstatusを利用して追加で2xx、3xxステータスコードを構文解析します。 構文解析したデータでHTTPリクエスト成功率データを生成できます。 除外するステータスコードには、2xx、3xxステータスコードを入力または選択できます。 入力されたステータスコードは、ログから2xx、3xxステータスコードを構文解析するときに除外されます。 

#### 設定項目{#log-parser-comp-status}

| 設定値          | 説明                                                                                                     | その他      |
| ------------ | ------------------------------------------------------------------------------------------------------ | -------- |
| カテゴリ         | リクエスト成功率データを生成するカテゴリです。                                                                                | required |
| ログ検出条件       | フィルターとして適用する検索キー、検索値を入力します。 ログ検出条件に合ったログデータに対してリクエスト成功率データを生成します。 ログ検出条件を入力しない場合は、すべてのログに対してデータを生成します。 | optional |
| 除外するステータスコード | リクエスト成功率データの作成時に除外するステータスコードです。 入力しなければ2xx~3xxに該当する全体の成功ステータスコードに対してリクエスト成功率データを生成します。                 | optional |

#### データ照会

パーサーをすべて登録したら、**_Flexボード_**に移動し、ログリクエスト成功率のウィジェットを作成してください。  

![Flexボード - ログリクエスト成功率のウィジェットテンプレート](https://img.whatap.io/22/11/28/120046log_success_rate_01_widget_template.png)  

ウィジェットを作成すると、次のようにデータを確認できます。

![Flexボード - ログリクエスト成功率のウィジェット](https://img.whatap.io/22/11/28/120046log_success_rate_02_widget.png)

チャート上のデータは、照会期間に関する統計を示します。 統計方法としては最近値、最大値、平均値などを選択できます。 最近値がデフォルト値として選択されています。

## クイックインデックス設定{#log-setting-index}

**_ログ設定_**メニューの上段で**_クイックインデックス設定_**タブを選択してください。 大量のログを収集すると、ログ検索性能が著しく低下する可能性があります。 よく使う検索条件は、**インデックス**(index)で生成すると、ログ検索の性能が向上し、クイック ナビゲーションが可能になります。 設定項目は次のとおりです。

| 設定値                  | 必修の有無      | 説明                                 |
| -------------------- | ---------- | ---------------------------------- |
| カテゴリ                 | 必須         | 高速クインデックスを設定するカテゴリ                 |
| 検索キー                 | 必須         | クイックインデックスを設定する検索キー                |
| 大文字と小文字を区別しない        | オプション      | 大文字と小文字を区別するかどうか                   |
| 規則                   | 必須         | `*` を一つ以上必ず含む。                     |
| アクティブ                | 必須         | アクティブ化または非アクティブ化の有無（デフォルト値`true`）  |

## ログ長期保存統計設定{#log-long-term-archive}

**_ログ設定_**メニューの上段で**_ログ長期保存統計_**タブを選択してください。 ログデータは、非常に大容量なので、長期間保存することは困難です。 したがって、ログ統計データの設定機能を使用して**特定の条件を満たすログデータが5分ごとに何件収集されたかに関する情報を保存**することができます。 長期間にわたって実際のログデータが削除されても、該当する条件を満たすログがどれだけ収集されたかの推移を確認することができます。

<!-- 

![로그 장기 보관 통계](https://img.whatap.io/22/11/28/090932log_022_long_period_stat_config.png)

1. ***対数長期保存統計***タブで***+追加する***ボタンを選択してください。 ***ログ長期保存統計追加***ウィンドウが表示されます。

1. ルールを適用する***カテゴリー***を選択してください。

1. ***データ保存日***を選択してください。

1. ルールを満たすログ発生時に保存する***統計キー***を設定してください。 同じキーを重複設定することはできません。

1. ***ルール名***入力ウィンドウに当該ルール名を入力してください。

1. ***タグ***を追加してください。

1. ***除外***をチェックすると、入力した条件に該当しない値に基づいて統計データを作成します。

1. ***大文字・小文字の区分***をチェックすると、入力したルールの値に対して大文字と小文字の区分を指定します。

1. 生成したルールは、***-***アイコンを通じて削除するか、***+追加する***ボタンで追加できます。

-->

### ログ長期保存統計追加{#log-long-term-archive-add}

![ログ長期保存統計](/img/log-long-term-archive.png)

**_ログ長期保存統計_**タブで**_+追加する_**ボタンを選択すると**_ログ長期保存統計追加_**ウィンドウが表示されます。 **_+追加する_**ボタンでルールを追加したり、作成したルールを**_-_**アイコンで削除できます。

#### 設定項目{#log-long-term-archive-comp}

| フィールド           | 説明                                                                                                                     |
| --------------- | ---------------------------------------------------------------------------------------------------------------------- |
| カテゴリ            | 規則を適用するカテゴリです。                                                                                                         |
| 統計キー(key)       | 規則を満たすログが発生した場合、保存するキー値で同じキーを重複設定することはできません。                                                                           |
| ログ検出条件          | ログ統計データを生成する条件です。 この条件を満たすログがどれだけ収集されたかに基づいて統計データを生成します。                                                               |
| 除外              | 除外をチェックすると、入力した条件に該当しない値で統計データを作成します。                                                                                  |
| 大文字と小文字の区分      | 入力したログ検出条件の値に対して大文字と小文字を区別有無を指定します。                                                                                    |
| アクティブ           | アクティブ化または非アクティブ化の有無（デフォルト値`true`）                                                                                      |

#### 例

次のように設定を追加した場合、収集されたログのうちstatusが`200`, `300`であるログを対象に**_TotalCount_**というキー値で統計データを作成します。 

![](/img/log-long-term-totalcount.png)

### データ照会{#log-widget-statistics}

1.  **_Flexボード_**の**_ウィジェットテンプレート_**で**_ログ長期保存統計_**を検索し、ウィジェットを作成してください。

    ![長期保存統計ウィジェットテンプレート](https://img.whatap.io/22/11/28/090932log_024_long_period_widget_template.png)

2.  データを照会する**_カテゴリー_**と**_キー_**を指定して**_適用_**ボタンを選択します。

    ![長期保存統計ウィジェット - カテゴリおよびキーの選択](https://img.whatap.io/22/11/28/090932log_025_long_period_widget_config.png)

3.  追加した設定値で**_ログ長期保存統計_**データを次のように確認できます。

    ![長期保存統計ウィジェット](https://img.whatap.io/22/11/28/090932log_026_long_period_widget_view.png)
