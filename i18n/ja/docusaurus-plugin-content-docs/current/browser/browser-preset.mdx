---
id: browser-preset
title: 事前設定
description: ブラウザーエージェントを適用するための事前設定方法を提供します。
tags:
  - ブラウザーモニタリング
  - 事前設定
---

ブラウザーエージェントを適用し、データ収集のために次のガイドに従って事前設定を進めてください。

## コンテンツセキュリティポリシーの設定

既存のコンテンツセキュリティポリシー（Content Security Policy、以下CSP）が設定されているウェブアプリケーションの場合、ブラウザーエージェントのCDN URLと収集データ送信のための収集サーバーのURLを追加する必要があります。

さらに、ブラウザーエージェントが効率的なデータ転送を行うためには、ウェブワーカー関連のCSPオプションを追加する必要があります。

| ディレクティブ（directive）          | ソース（source）                                        | 説明                                                           |
| --------------------------- | -------------------------------------------------- | ------------------------------------------------------------ |
| script-src, script-src-elem | unsafe-inline                                      | ブラウザーエージェントをインラインスクリプトとしてインストール                              |
| script-src, script-src-elem | https://repo.whatap-browser-agent.io/rum/prod/     | ブラウザーエージェントCDNドメイン                                           |
| connect-src                 | https://rum-ap-northeast-2.whatap-browser-agent.io | 収集したデータを送信するためのドメイン                                          |
| worker-src, child-src       | blob:                                              | ブラウザーエージェントの効率的なデータ転送のためのウェブワーカー関連のCSPオプション（推奨事項）            |

## Timing-Allow-Origin設定

リソースを提供するサーバーにCORSを適用すると、ほとんどのリソースタイミング属性を0として返します。 브라우저 에이전트가 리소스의 속성 값을 수집하려면 서버에서 `Timing-Allow-Origin` HTTP 응답 헤더를 반환해야 합니다. 

リソースを提供するサーバーが制御可能な場合は、各レスポンスにヘッダーを追加し、属性にアクセスするすべてのドメイン（ブラウザーエージェントを適用したウェブサイトのドメイン）を追加する必要があります。

-   例 1：すべてのソースでリソースタイミング情報を提供します。
    ```json
    Timing-Allow-Origin: *
    ```
-   例 2：ブラウザーエージェントを適用したウェブ アプリケーションのドメインに限ってリソースタイミング情報を提供します。
    ```json
    Timing-Allow-Origin: www.site.com
    ```
