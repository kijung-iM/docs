---
id: weaving-plugin
title: Weaving plug-in
description: The weaving plug-ins are provided to trace open sources and complex codes by the Java agent.
tags:
  - Java
  - Weaving plug-in
---

The Java agent provides separate weaving plug-ins to trace any open source or user-defined complex code. This plug-in is used by the Java agent to trace and collect the calls of the open source library that is not hooked.

## Embedded weaving plug-in

The Java agent embeds some weaving plug-ins. The embedded plug-ins can be used through the Java agent configuration file (_whatap.conf_). By adding the `weaving_reserved` option, the configuration is enabled. From WhaTap agent 2.1.1, the `weaving` option can be set additionally.

-   WhaTap agent 2.0_01 or later

    ```ini title='$WHATAP_HOME/whatap.conf'
    weaving_reserved=okhttp3
    ```

-   WhaTap agent 2.1.1 or later

    ```ini title='$WHATAP_HOME/whatap.conf'
    weaving=tomcat10
    ```

### Embedded weaving plug-ins and versions

Other weaving plug-ins that have been embedded can be set through the option: `weaving_reserved` or `weaving`. Set the library version without the _.jar_ extension.

```bash
akka-2.5.jar
apache-httpclient-4.5.jar
axis-1.4.jar
elasticsearch-client-6.4.jar
hystrix-1.5.jar
jedis-2.9.3.jar
jedis-3.2.jar
okhttp-2.7.jar
okhttp3.jar
okhttp-3.4.6.jar
play-2.7.jar
reactor-rabbitmq-1.2.jar
spring-batch-4.1.jar
springboot-start.jar
spring-cloud-gateway-2.1.jar
spring-cloud-gateway-2.2.jar
spring-cloud-gateway-2.2.1.jar
spring-kafka-1.3.jar
spring-kafka-2.4.jar
spring-mongodb-2.2.jar
spring-rabbitmq-2.1.jar
tomcat-boot.jar
webflux-5.1.jar
webflux-5.2.jar
webflux-5.3.jar
```

```ini title='$WHATAP_HOME/whatap.conf 예시'
weaving_reserved=webflux-5.2,spring-cloud-gateway-2.2
```

## External weaving plug-ins

### Installation method

After installing the Java agent, create the _instrument_ folder under the Java agent Home, and then copy and paste the weaving plug-ins under the _instrument_ folder. When you restart the Java application after installation, run the weaving plug-ins in the _instrument_ folder.

### Application example

-   Before application

      ![Before application of weaving plug-in](/img/java-plugin-weaving-01.png)

-   After application

      ![After application of weaving plug-in](/img/java-plugin-weaving-02.png)

## User-defined development

Any Java agent user can create weaving plug-ins the way the user has defined. Weaving plug-in jar file names must start with **whatap** or **weav**.

In case of a weaving plug-in jar file, the **PlugIn** and **Build** attributes must be defined in _MANIFEST.MF_. To apply weaving plug-ins, create the _instrument_ folder under the Java agent Home, and then copy and paste the weaving plug-ins under the _instrument_ folder.

> $WHATAP_HOME/instrument
